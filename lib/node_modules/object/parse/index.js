module.exports = parse;
var isNotNan = require('is/not-nan');
var isString = require('is/string');
var wraptry = require('function/wrap-try');
var couldBeJSON = require('JSON/could-be');
var JSONParse = require('JSON/parse');
var toNumber = require('to/number');
var has = require('object/has');
var baseDataTypes = require('is/base-data-types');
var evaluate = require('function/evaluate');

function parse(val_) {
    var valTrimmed, valLength, coerced, val = val_;
    if (!isString(val)) {
        // already parsed
        return val;
    }
    val = valTrimmed = val.trim();
    valLength = val.length;
    if (!valLength) {
        return val;
    }
    if (has(baseDataTypes, val)) {
        return baseDataTypes[val];
    }
    coerced = toNumber(val);
    if (isNotNan(coerced)) {
        return coerced;
    }
    if (couldBeJSON(val)) {
        if ((val = wraptry(function () {
                return JSONParse(val);
            }, function () {
                return val;
            })) !== valTrimmed) {
            return val;
        }
    }
    if (val.slice(0, 8) === 'function' && val[val.length - 1] === '}') {
        return evaluate('return ' + val);
    }
    return val;
}